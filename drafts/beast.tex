\documentclass{acm_proc_article-sp}
\usepackage{svg}
\usepackage{listings}
% \usepackage{ref}
\lstset{
    numberblanklines=false,
    language=make,
    tabsize=4,
    frame=single,
    keywordstyle=\color{red},
    identifierstyle= %plain identifiers for make
}
\begin{document}

\title{
BEAST TITLE TO-FILL
%\titlenote{(Does NOT produce the permission block, copyright information nor page numbering). For use with ACM\_PROC\_ARTICLE-SP.CLS. Supported by ACM.}
}
\numberofauthors{5}
\author{
\alignauthor
Yang Shichu\\
    % \affaddr{School of Cyber Science and Engineering}\\
    \affaddr{Huazhong University of Science and Technology}\\
    \email{TO-FILL}
\alignauthor
Shu Yi\\
    % \affaddr{}\\
    \affaddr{Huazhong University of Science and Technology}\\
    \email{TO-FILL}
\alignauthor
Su Haochen\\
    % \affaddr{TO-FILL}\\
    \affaddr{Sichuan University}\\
    \email{TO-FILL}
\and
\alignauthor
Li Yucong\\
    % \affaddr{TO-FILL}\\
    \affaddr{Shandong University}\\
    \email{TO-FILL}
\alignauthor
Liao Haicheng\\
    % \affaddr{TO-FILL}\\
    \affaddr{University of Electronic Science and Technology of China}\\
    \email{TO-FILL}
}
\date{27 July 2021}
\maketitle
\begin{abstract}
Transport Layer Security (TLS) is an protocol that provides communication
security over networks. However, there is a flaw in TLS 1.0 where the initial
vectors for block ciphers are predictable. The BEAST attack, with some
prerequisites and efforts, allows attackers in the middle to decrypt those
encrypted messages without knowing the key.
This paper will demonstrate the procedures of the BEAST attack, and propose
methods in simulation and vulnerability detection.
\end{abstract}

% A category with the (minimum) three required fields
% \category{H.4}{Information Systems Applications}{Miscellaneous}
%A category including the fourth, optional field follows...
% \category{D.2.8}{Software Engineering}{Metrics}[complexity measures, performance measures]

% \terms{}

\keywords{BEAST attack, TLS flaws, CBC exploits, vulnerability detection} % NOT required for Proceedings

\section{Introduction}
Transport Layer Security (TLS) has several versions. The specification for TLS
1.0 is RFC 2246\cite{rfc2246}.
In this paper we will show a flaw in one of the common modes of operation used in block ciphers
and how it allows for a specific kind of attack\cite{beast} on HTTPS.

%\end{document}  % This is where a 'short' article might terminate
\section{Background}
\subsection{A glance at TLS}

TLS is a protocol for safe data transferring that works between the transport layer
and the application layer. The cipher suites used in TLS often involve an asymmetric cipher
(e.g. RSA) for key exchanging and a symmetric block cipher (e.g. AES) for message encryption.
The protocol is widely used together with data transfer applications such as HTTP, FTP and SMTP.

\subsection{CBC in block ciphers}
Cipher Block Chaining (CBC) is one of the modes of operation used in block ciphers.
In order to reduce the time spent on generating random initialization vectors (IVs), CBC always takes
the previous encrypted ciphertext block and use it as the IV for the current plaintext block before the
block cipher encrypts, except for the first block as shown in Figure 1.

Suppose that $P_1,P_2,\cdots P_n$ are the plaintext blocks, with a initialization vector $IV$, we have:

$$
\begin{aligned}
C_1&=E_k(P_1\oplus IV)\\
C_i&=E_k(P_{i}\oplus C_{i-1}) (i\geq 2)
\end{aligned}
$$

to obtain ciphertext blocks $C_1,C_2,\cdots,C_n$.

\begin{figure}[htb]
  \centering
  \includesvg[keepaspectratio, width=\linewidth]{./figures/cbc-encryptor.drawio.svg}
  \caption{CBC encryptor}
\end{figure}

\section{The BEAST Attack}
\subsection{Predictable IV and Consequences}
As we mentioned in Section 2.2, a block cipher using CBC always takes its previous cipher block as
its next IV. This means that an attacker who has been eavesdropping the whole encrypted
conversation can infer all the IVs in the conversation except for the first one.
If the attacker has control over such an encryption machine (i.e. he has chosen plaintext privilege),
in an attempt to guess the plaintext of block $C_k$ with a guessed plaintext block $P_k'$,
assuming the encryption machine is about to encrypt the $i+1$th block,

he can pass
$$
\begin{aligned}
P_{i+1}&=P_k'\oplus C_i\oplus C_{k-1}
\end{aligned}
$$
to the machine. So that the ciphertext block would be
$$
\begin{aligned}
C_{i+1}&=E_k(P_k'\oplus C_i\oplus C_{k-1}\oplus C_i)=E_k(P_k'\oplus C_{k-1})
\end{aligned}
$$
Since the block cipher algorithm used in TLS is deterministic
(i.e. same plaintext encrypts to same ciphertext),

and $C_k = E_k(P_k\oplus C_{k-1})$,

If $C_{i+1} = C_k$, then
$$
\begin{aligned}
P_k\oplus C_{k-1}&= P_k'\oplus C_{k-1}\\
P_k&= P_k'
\end{aligned}
$$
The procedure shown above is actually a validation oracle which tells whether the attacker's guess
on $P_k$ is correct. In conclusion, an attacker with chosen plaintext privilege in this case can use
brute force to obtain the plaintext of any cipher block $C_k(k\geq 2)$.
\subsection{Chosen Boundary Attacks}

\section{Threat Model}
\subsection{Prerequisites for attackers}
\begin{itemize}
    \item TO-DO
\end{itemize}

\section{Demonstration}
\section{Feasibility and Defense}
\subsection{Feasibility}
While BEAST attacks are theoretically feasible, with the enhancement of security
features of browsers and other clients, BEAST attacks are less and less practical
for an attacker to exploit.

\subsubsection{CORS}
CORS is a group of policies to regulate the contents of cross-origin requests.
An attacker cannot make a request to other sites using JavaScript. If an attacker
wants to send some requests to Facebook, they will be rejected by browser's policies.

That is to say, when attackers want the clients to forge a request to websites with
credentials. These requests will not be sent. Thus, BEAST attacks will not work
any longer.

\subsubsection{WebSocket mask}
WebSocket is not subject to CORS policies, and it can be also wrapped by TLS.
It seems that WebSocket will be a good choice to implement BEAST attack.

However, in modern clients, WebSocket payloads are masked by a value shown in \ref{fig:websocket-mask}.

\begin{figure}[htb]
    \centering
    \includegraphics[keepaspectratio, width=\linewidth]{./figures/websocket-mask.png}
    \caption{WebSocket mask}
    \label{fig:websocket-mask}
\end{figure}

Besides, WebSocket prepends extra bits before real payload. It is still hard to
control the block boundary.

The mask makes it hard for attackers to do BEAST attacks, since the attack requires
the first sent block mostly controllable by attackers.

\subsection{Defense}
BEAST attacks make use of a flaw in the specification of TLS 1.0, and the attack only
works for block ciphers. That is to say, stream ciphers with TLS 1.0 are not
vulnerable to BEAST attacks.

However, TLS 1.0 is still vulnerable to other attacks when using stream ciphers (e.g. RC4).
Therefore, a much more direct way is just to abandon TLS 1.0, and update to later TLS
versions.

Many modern browsers and clients have also limited users to browse those sites
with TLS 1.0 enabled alone. This kind of action will boost organizations to update their
websites TLS versions. Today there are only few sites supporting TLS 1.0.

\section{Detection}

We will propose a method to detect BEAST vulnerability of a server, together with a
Python script which is easy to use.

At the stage of TLS handshake, a cipher suite will be selected through steps:

\begin{enumerate}
    \item (Client Hello) Client sent a list of accepted cipher suites.
    \item (Server Hello) Server chose a best accepted cipher suite, or a handshake failure occured.
\end{enumerate}

\begin{figure}[htb]
    \centering
    \includegraphics[keepaspectratio, width=\linewidth]{./figures/tls-handshake-cipher-spec.png}
    \caption{Negotiation on the cipher suite}
\end{figure}

Based on this, a scanner could change the list of cipher suites to enumerate all
cipher suites that the server will accept.

The server is vulnerable to BEAST attacks if it accepts TLS 1.0 handshake and support
cipher suites with CBC modes.

\begin{lstlisting}[language=bash]
python scan.py host port
\end{lstlisting}

The \texttt{openssl} utility is able to start a TLS server with many options.

\begin{lstlisting}
openssl s_server \
    -CAfile ca_cert.pem \
    -cert server_cert.pem \
    -key server_key.pem \
    -HTTP -port 5008 -tls1
\end{lstlisting}

\begin{figure}[htb]
    \centering
    \includegraphics[keepaspectratio, width=\linewidth]{./figures/detection-output.png}
    \caption{Detection output on a TLS 1.0 server}
\end{figure}

% \subsection{}
%ACKNOWLEDGMENTS are optional
% The following two commands are all you need in the
% initial runs of your .tex file to
% produce the bibliography for the citations in your paper.
\bibliographystyle{abbrv}
\bibliography{beast}  % sigproc.bib is the name of the Bibliography in this case
% You must have a proper ".bib" file
%  and remember to run:
% latex bibtex latex latex
% to resolve all references
%
% ACM needs 'a single self-contained file'!
%
%APPENDICES are optional
\balancecolumns
\appendix
%Appendix A
% \section{Headings in Appendices}
% \section{Detection script for BEAST}
% \begin{lstlisting}[language=Python]
% \end{lstlisting}
\balancecolumns
\end{document}
